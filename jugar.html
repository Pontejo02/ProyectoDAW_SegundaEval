<!DOCTYPE html>
<html>
<head>
	<title>Juego</title>
	<link rel="stylesheet" type="text/css" href="estilojuego.css">
</head>
<body>
	<div class="bloquesJuego">
		<div class="barraPuntuacion">
			<div id="btnAtras"><</div>
		</div>
		<canvas id="juego"></canvas>
	</div>
	<img hidden id="bloques" src="./media/marron.jpeg"/>
	<script type="text/javascript">
		const canvas =document.getElementById('juego');
		const ctx= canvas.getContext('2d');
		const $bloques= document.querySelector('#bloques');
		const rect =canvas.getBoundingClientRect();

		canvas.width=700;
		canvas.height=500;
		const inicioRandom= Math.random() * (10 - (-10)) + (-10);
		//funciones objetos

		//variables de la pelota
		const pel={
			//posicion pelota inicial
			x: canvas.width/2,
		 	y: canvas.height -50,
		 	//radiopelota
			radius: 8,
			//velocidades
			vx: inicioRandom,
			vy: -2
		};

		//variables de la barra
		const bar={
			//posicion de la barra
			x: 275,
			y: canvas.height -30,
			//ancho y alto
			ancho: 150,
			alto: 10,
			//velocidad barra
			vx: 10
		};

		function pelota(){
			ctx.beginPath();
			ctx.arc(pel.x, pel.y, pel.radius, 0, Math.PI * 2);
			ctx.fillStyle = "#4c370f";
			ctx.fill();
			ctx.closePath();
		};

		function movimientoPelota(){
			pel.x += pel.vx;
			pel.y += pel.vy;
		}

		function barra(){
			ctx.fillRect(bar.x,bar.y,bar.ancho,bar.alto);
			ctx.fillStyle = "#4c370f";
		};

		/* VARIABLES DE LOS LADRILLOS */
		  const numeroLadrillosFilas = 6;
		  const numeroLadrillosColumnas = 30;
		  const anchoLadrillo = 20;
		  const altoLadrillo = 20;
		  const separacionLadrillos = 2;
		  const separacionArriba = 50;
		  const separacionIzquierda = 26;
		  const ladrillos = [];

		  const ESTADO_LADRILLO = {
		    VIVO: 1,
		    DESTRUIDO: 0
		  }

		  
		  for (let c = 0; c < numeroLadrillosColumnas; c++) {
		    ladrillos[c] = [] // inicializamos con un array vacio
		    for (let r = 0; r < numeroLadrillosFilas; r++) {
		      // calculamos la posicion del ladrillo en la pantalla
		      const ladrilloX = c * (anchoLadrillo + separacionLadrillos) + separacionIzquierda
		      const ladrilloY = r * (altoLadrillo + separacionLadrillos) + separacionArriba
		      // Asignar un color aleatorio a cada ladrillo
		      const random = Math.floor(Math.random() * 8)
		      // Guardamos la información de cada ladrillo
		      ladrillos[c][r] = {
		        x: ladrilloX,
		        y: ladrilloY,
		        status: ESTADO_LADRILLO.VIVO,
		        color: random
		      }
		    }
		  }
		function bloques() {
		    for (let c = 0; c < numeroLadrillosColumnas; c++) {
		      for (let r = 0; r < numeroLadrillosFilas; r++) {
		        const ladrilloActual = ladrillos[c][r]
		        if (ladrilloActual.status === ESTADO_LADRILLO.DESTRUIDO) continue;

		        const clipX = ladrilloActual.color * 32  //borrar esto era de cuando teniamos bloques de color

		        ctx.drawImage(
		          $bloques,
		          clipX,
		          0,
		          anchoLadrillo,
		          altoLadrillo,
		          ladrilloActual.x,
		          ladrilloActual.y,
		          anchoLadrillo,
		          altoLadrillo
		        )
		      }
		    }
		  }

		function limpiarPantalla() {
		    ctx.clearRect(0, 0, canvas.width, canvas.height);
		}

		function movimientoBarra() {
		  if (!movimientoBarra.iniciado) {

		    document.addEventListener("keydown", (e) => {
		      if (e.key === "ArrowRight") {
		        bar.direccion = 1;
		      } else if (e.key === "ArrowLeft") {
		        bar.direccion = -1;
		      }
		    });

		    document.addEventListener("keyup", (e) => {
		      if (e.key === "ArrowRight" || e.key === "ArrowLeft") {
		        bar.direccion = 0;
		      }
		    });

		    document.addEventListener("mousemove", (e) => {
			    bar.x = e.clientX-500;
			});

		    bar.direccion = 0;
		    movimientoBarra.iniciado = true;

		  }

		  bar.x += bar.direccion * bar.vx;
		}

		function colision(){
			//colision con paredes
			if (pel.x + pel.radius > canvas.width || pel.x - pel.radius < 0) {
			    pel.vx *= -1;
			  }

			  if (pel.y - pel.radius < 0) {
			    pel.vy *= -1;
			  }
		    // Colisión con barra
		    if (
		        pel.x + pel.radius > bar.x &&
		        pel.x - pel.radius < bar.x + bar.ancho &&
		        pel.y + pel.radius > bar.y &&
		        pel.y - pel.radius < bar.y + bar.alto
		    ) {
		        pel.vy = -Math.abs(pel.vy); // fuerza que rebote hacia arriba
		    }
		}

		function choqueLadrillos(){
			// Colisión con ladrillos
			for (let c = 0; c < numeroLadrillosColumnas; c++) {
			  for (let r = 0; r < numeroLadrillosFilas; r++) {

			    const ladrillo = ladrillos[c][r];

			    if (ladrillo.status === ESTADO_LADRILLO.VIVO) {

			      if (
			        pel.x + pel.radius > ladrillo.x &&
			        pel.x - pel.radius < ladrillo.x + anchoLadrillo &&
			        pel.y + pel.radius > ladrillo.y &&
			        pel.y - pel.radius < ladrillo.y + altoLadrillo
			      ) {
			        pel.vy *= -1; // rebote
			        ladrillo.status = ESTADO_LADRILLO.DESTRUIDO;
			      }
			    }
			  }
			}

		}

		  

		//dentro de esta funcion tendremos todas las funciones que necesitaremos para el juego
		function pintar(){
			//estos son los diferentes objetos que tendremos que pueden interactuar
			limpiarPantalla();
			pelota();
			bloques();
			barra();
			choqueLadrillos();
			//otro tipo de funciones
			colision();
			//desaparecerbloque()
			//rebote()
			//puntos()
			//evento()
			movimientoPelota();
			movimientoBarra();

			window.requestAnimationFrame(pintar);
		};
		pintar();


	</script>
</body>
</html>